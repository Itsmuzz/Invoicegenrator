





















<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Invoice Generator â€” Vercel Static</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

  <!-- Firebase Compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>

<body class="bg-gray-50 text-gray-800">
  <div class="max-w-6xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-2xl font-bold">Invoice Generator â€” Free static (Vercel)</h1>
      <p class="text-sm text-gray-600">Mobile-first, PDF export, client save, GST calc.</p>
    </header>

    <main class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- LEFT: FORM -->
      <section class="bg-white p-4 rounded shadow">

        <div class="flex items-center justify-between mb-3">
          <h2 class="font-semibold">Create Invoice</h2>
          <div id="authArea" class="text-sm"></div>
        </div>

        <div class="space-y-3">
          <div class="grid grid-cols-2 gap-2">
            <input id="invoiceNo" class="border p-2 rounded" placeholder="Invoice#" />
            <input id="invoiceDate" type="date" class="border p-2 rounded" />
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <input id="sellerName" class="border p-2 rounded" placeholder="Seller name" />
            <input id="sellerGST" class="border p-2 rounded" placeholder="Seller GST (optional)" />
          </div>
          <textarea id="sellerAddr" class="border p-2 rounded" placeholder="Seller address"></textarea>

          <hr />

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <input id="buyerName" class="border p-2 rounded" placeholder="Buyer name" />
            <input id="buyerGST" class="border p-2 rounded" placeholder="Buyer GST (optional)" />
          </div>
          <textarea id="buyerAddr" class="border p-2 rounded" placeholder="Buyer address"></textarea>

          <div class="flex gap-2">
            <select id="taxMode" class="border p-2 rounded w-full">
              <option value="no">No GST</option>
              <option value="intra">Intra-state (CGST+SGST)</option>
              <option value="inter">Inter-state (IGST)</option>
            </select>
            <input id="gstPercent" type="number" value="18" class="w-28 border p-2 rounded" />
          </div>

          <hr />

          <div>
            <h3 class="font-medium">Items</h3>
            <div id="items" class="space-y-2 mt-2"></div>
            <button id="addItem" class="mt-2 px-3 py-1 bg-blue-600 text-white rounded">+ Add item</button>
          </div>

          <div class="flex justify-between items-center">
            <div class="text-sm text-gray-600">Subtotal:</div>
            <div id="subtotal" class="font-semibold">â‚¹0</div>
          </div>

          <div class="flex gap-2">
            <button id="calcBtn" class="px-3 py-2 bg-green-600 text-white rounded">Calculate</button>
            <button id="saveInvoice" class="px-3 py-2 bg-indigo-600 text-white rounded">Save</button>
            <button id="downloadPDF" class="px-3 py-2 bg-gray-800 text-white rounded">Download PDF</button>
            <button id="whatsappShare" class="px-3 py-2 bg-emerald-500 text-white rounded">Share (WhatsApp)</button>
          </div>
        </div>
      </section>

      <!-- RIGHT: CLIENT LIST + INVOICES -->
      <section class="bg-white p-4 rounded shadow">
        <h3 class="font-semibold mb-2">Saved Clients</h3>
        <div id="clientsList" class="space-y-2 max-h-64 overflow-auto"></div>

        <hr class="my-3" />

        <h3 class="font-semibold mb-2">Recent Invoices</h3>
        <div id="invoicesList" class="space-y-2 max-h-64 overflow-auto"></div>
      </section>
    </main>
  </div>

<script>
/* -------------------------  
   ðŸ”¥ FIREBASE CONFIG (READY)
-------------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyAJqxYHoOSVFSCbtRFaYTuYDOYoU-AOrJ0",
  authDomain: "invoice-generator-muzz.firebaseapp.com",
  projectId: "invoice-generator-muzz",
  storageBucket: "invoice-generator-muzz.firebasestorage.app",
  messagingSenderId: "989655233598",
  appId: "1:989655233598:web:2bf58e4b6c3031c7100d6f",
  measurementId: "G-MBTQNN1TB3"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* -----------------------------------------
   BELOW THIS â€” ALL LOGIC SAME AS ORIGINAL
--------------------------------------------*/

function genInvoiceId(){
  const d = new Date();
  return "INV-" + d.getTime();
}

const invoiceNo = document.getElementById('invoiceNo');
const invoiceDate = document.getElementById('invoiceDate');
const sellerName = document.getElementById('sellerName');
const sellerAddr = document.getElementById('sellerAddr');
const sellerGST = document.getElementById('sellerGST');
const buyerName = document.getElementById('buyerName');
const buyerAddr = document.getElementById('buyerAddr');
const buyerGST = document.getElementById('buyerGST');
const itemsDiv = document.getElementById('items');
const subtotalEl = document.getElementById('subtotal');

invoiceDate.valueAsDate = new Date();
invoiceNo.value = genInvoiceId();

let items = [];
function addItemRow(it = {desc:'', qty:1, rate:0}) {
  const idx = items.length;
  items.push(it);
  const row = document.createElement('div');
  row.className = 'grid grid-cols-12 gap-2 items-center';
  row.innerHTML = `
    <input data-idx="${idx}" data-field="desc" class="col-span-5 border p-2 rounded" placeholder="Description" value="${it.desc}" />
    <input data-idx="${idx}" data-field="qty" type="number" class="col-span-2 border p-2 rounded" value="${it.qty}" />
    <input data-idx="${idx}" data-field="rate" type="number" class="col-span-3 border p-2 rounded" value="${it.rate}" />
    <div class="col-span-1 text-sm" data-idx="${idx}" data-field="line">â‚¹0</div>
    <button class="col-span-1 px-2 py-1 bg-red-500 text-white rounded" data-action="remove" data-idx="${idx}">X</button>
  `;
  itemsDiv.appendChild(row);
}

addItemRow();

itemsDiv.addEventListener("input", e => {
  const el = e.target;
  const idx = el.dataset.idx;
  const field = el.dataset.field;
  if (idx == null) return;
  const val = field === "desc" ? el.value : Number(el.value);
  items[idx][field] = val;
});

itemsDiv.addEventListener("click", e => {
  if (e.target.dataset.action === "remove") {
    const idx = Number(e.target.dataset.idx);
    items[idx] = null;
    e.target.closest("div").remove();
    recalc();
  }
});

document.getElementById("addItem").onclick = () => addItemRow();

function recalc() {
  let sub = 0;
  items.forEach((it, i) => {
    if (!it) return;
    const line = (it.qty || 0) * (it.rate || 0);
    sub += line;
    const lineEl = itemsDiv.querySelector(`[data-idx='${i}'][data-field='line']`);
    if (lineEl) lineEl.innerText = "â‚¹" + line;
  });
  subtotalEl.innerText = "â‚¹" + sub;
  return sub;
}

function calcTaxes(sub) {
  const mode = taxMode.value;
  const gst = Number(gstPercent.value) || 0;
  if (mode === "no") return { cgst:0, sgst:0, igst:0, total:sub };

  const tax = (sub * gst) / 100;

  if (mode === "intra") {
    return { cgst: tax/2, sgst: tax/2, igst:0, total: sub + tax };
  }
  return { cgst:0, sgst:0, igst: tax, total: sub + tax };
}

async function saveClient(name, addr, gst) {
  if (!name) return;
  await db.collection("clients").doc(name).set({
    name, addr, gst,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  });
}

async function saveInvoiceToFirestore(payload) {
  const id = payload.invoiceNo;
  await db.collection("invoices").doc(id).set(payload);
  renderRecentInvoices();
}

async function renderClients() {
  const snap = await db.collection("clients").orderBy("updatedAt", "desc").limit(50).get();
  clientsList.innerHTML = "";
  snap.forEach(d => {
    const c = d.data();
    const el = document.createElement("div");
    el.className = "p-2 rounded border flex justify-between items-center";
    el.innerHTML = `
      <div>
        <div class="font-medium">${c.name}</div>
        <div class="text-xs text-gray-600">${c.gst || ""}</div>
      </div>
      <button class="px-2 py-1 bg-blue-600 text-white rounded" data-name="${c.name}">Use</button>
    `;
    el.querySelector("button").onclick = () => {
      buyerName.value = c.name;
      buyerAddr.value = c.addr || "";
      buyerGST.value = c.gst || "";
    };
    clientsList.appendChild(el);
  });
}

async function renderRecentInvoices() {
  const snap = await db.collection("invoices").orderBy("invoiceDate", "desc").limit(50).get();
  invoicesList.innerHTML = "";
  snap.forEach(d => {
    const inv = d.data();
    const el = document.createElement("div");
    el.className = "p-2 rounded border flex justify-between items-center";
    el.innerHTML = `
      <div>
        <div class='font-medium'>${inv.invoiceNo}</div>
        <div class='text-xs text-gray-600'>${inv.buyerName} â€¢ â‚¹${inv.total}</div>
      </div>
      <button class="px-2 py-1 bg-gray-800 text-white rounded">View</button>
    `;
    el.querySelector("button").onclick = () => loadInvoice(inv);
    invoicesList.appendChild(el);
  });
}

function loadInvoice(inv) {
  invoiceNo.value = inv.invoiceNo;
  invoiceDate.value = new Date(inv.invoiceDate.seconds * 1000).toISOString().slice(0, 10);
  sellerName.value = inv.sellerName;
  sellerAddr.value = inv.sellerAddr;
  sellerGST.value = inv.sellerGST;
  buyerName.value = inv.buyerName;
  buyerAddr.value = inv.buyerAddr;
  buyerGST.value = inv.buyerGST;

  items = [];
  itemsDiv.innerHTML = "";
  inv.items.forEach(it => addItemRow({ desc: it.desc, qty: it.qty, rate: it.rate }));
  recalc();
}

document.getElementById("calcBtn").onclick = () => {
  recalc();
  alert("Calculated");
};

document.getElementById("downloadPDF").onclick = () => downloadPDF();
document.getElementById("whatsappShare").onclick = () => shareWhatsApp();

document.getElementById("saveInvoice").onclick = async () => {
  const sub = recalc();
  const taxes = calcTaxes(sub);

  const payload = {
    invoiceNo: invoiceNo.value,
    invoiceDate: firebase.firestore.Timestamp.fromDate(new Date(invoiceDate.value)),
    sellerName: sellerName.value,
    sellerAddr: sellerAddr.value,
    sellerGST: sellerGST.value,
    buyerName: buyerName.value,
    buyerAddr: buyerAddr.value,
    buyerGST: buyerGST.value,
    items: items.filter(Boolean),
    subtotal: sub,
    ...taxes,
    total: taxes.total,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  };

  await saveClient(buyerName.value, buyerAddr.value, buyerGST.value);
  await saveInvoiceToFirestore(payload);

  alert("Saved successfully!");
};

function shareWhatsApp() {
  const sub = recalc();
  const taxes = calcTaxes(sub);

  let t = `Invoice ${invoiceNo.value}%0A`;
  t += `Buyer: ${buyerName.value}%0A`;
  t += `Subtotal: â‚¹${sub}%0A`;
  t += `Total: â‚¹${taxes.total}%0A`;

  const url = "https://wa.me/?text=" + encodeURIComponent(t);
  window.open(url, "_blank");
}

async function initAuth() {
  try {
    await auth.signInAnonymously();
    document.getElementById("authArea").innerHTML =
      "<span class='text-green-600'>Signed in (anonymous)</span>";
    renderClients();
    renderRecentInvoices();
  } catch (e) {
    document.getElementById("authArea").innerHTML = "Auth error";
  }
}
initAuth();
</script>

</body>
</html>
